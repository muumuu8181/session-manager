<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 5px;
            background-color: #f5f5f5;
            font-size: 11px;
            display: flex;
            gap: 10px;
        }
        .container {
            background: white;
            border-radius: 4px;
            padding: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            flex: 1;
            max-width: 400px;
        }
        .vertical-progress-container {
            display: flex;
            gap: 5px;
        }
        .vertical-progress {
            width: 15px;
            height: 300px;
            background: #e0e0e0;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        .vertical-progress-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            transition: height 0.3s ease;
            border-radius: 8px;
        }
        .vertical-progress-fill-1 {
            background: #4CAF50;
        }
        .vertical-progress-fill-2 {
            background: #FFC107;
        }
        .vertical-progress-fill-3 {
            background: #f44336;
        }
        h1 {
            color: #333;
            margin: 5px 0 10px 0;
            font-size: 16px;
        }
        h3 {
            font-size: 12px;
            margin: 5px 0;
        }
        .session-info {
            background: #f0f7ff;
            border-radius: 3px;
            padding: 5px;
            margin-bottom: 8px;
            font-size: 10px;
        }
        .session-info p {
            margin: 2px 0;
            display: inline-block;
            margin-right: 10px;
        }
        .current-session {
            background: #e8f5e9;
            border-radius: 3px;
            padding: 5px;
            margin-bottom: 8px;
            display: none;
            font-size: 10px;
        }
        .current-session p {
            margin: 2px 0;
            display: inline-block;
            margin-right: 10px;
        }
        .progress-container {
            width: 100%;
            margin: 5px 0;
        }
        .progress-container-top {
            width: 100%;
            margin: 0 0 10px 0;
        }
        .progress-bar-group {
            display: flex;
            gap: 2px;
            margin-bottom: 2px;
        }
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        .progress-fill-session1 {
            background: #4CAF50;
        }
        .progress-fill-session2 {
            background: #FFC107;
        }
        .progress-fill-session3 {
            background: #f44336;
        }
        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            color: #666;
        }
        .time-input-container {
            margin: 5px 0;
            padding: 5px;
            background: #f0f7ff;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .time-input-container h4 {
            font-size: 10px;
            margin: 0;
        }
        .time-input {
            padding: 4px;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin: 0 3px;
        }
        .remaining-time {
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            margin: 5px 0;
        }
        .time-good {
            color: #4CAF50;
        }
        .time-warning {
            color: #FFC107;
        }
        .time-danger {
            color: #f44336;
        }
        .time-display {
            font-size: 14px;
            font-weight: bold;
            margin: 5px 0;
        }
        .warning {
            color: #ff6b6b;
            font-weight: bold;
        }
        .recommended {
            color: #ff9800;
            font-weight: bold;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 4px 8px;
            font-size: 10px;
            border-radius: 2px;
            cursor: pointer;
            margin-right: 3px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #stopBtn {
            background: #f44336;
        }
        #stopBtn:hover {
            background: #da190b;
        }
        .history {
            margin-top: 8px;
        }
        .history-item {
            border-bottom: 1px solid #eee;
            padding: 2px 0;
            font-size: 9px;
        }
        .day-header {
            background: #f5f5f5;
            padding: 3px 5px;
            margin: 5px 0 2px 0;
            font-weight: bold;
            font-size: 10px;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .day-status-good {
            color: #4CAF50;
        }
        .day-status-warning {
            color: #FFC107;
        }
        .day-status-danger {
            color: #f44336;
        }
        .stats {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }
        .stat-box {
            flex: 1;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 3px;
            text-align: center;
        }
        .stat-number {
            font-size: 16px;
            font-weight: bold;
            color: #2196F3;
        }
        .stat-label {
            color: #666;
            font-size: 9px;
        }
        .debug-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            font-family: monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
            border-top: 2px solid #34495e;
            z-index: 1000;
        }
        .debug-controls {
            margin-bottom: 5px;
        }
        .debug-controls button {
            margin-right: 5px;
            padding: 3px 8px;
            font-size: 10px;
        }
        .debug-log {
            background: #34495e;
            padding: 5px;
            border-radius: 3px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="vertical-progress-container" id="verticalProgressContainer" style="display: none;">
        <div class="vertical-progress">
            <div class="vertical-progress-fill vertical-progress-fill-1" id="verticalProgressFill1" style="height: 0%"></div>
        </div>
        <div class="vertical-progress">
            <div class="vertical-progress-fill vertical-progress-fill-2" id="verticalProgressFill2" style="height: 0%"></div>
        </div>
        <div class="vertical-progress">
            <div class="vertical-progress-fill vertical-progress-fill-3" id="verticalProgressFill3" style="height: 0%"></div>
        </div>
    </div>
    
    <div class="container">
        <h1>Claude ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</h1>
        
        <div class="session-info">
            <p>1ã‚»ãƒƒã‚·ãƒ§ãƒ³:5æ™‚é–“</p>
            <p>æœˆé–“:50å›</p>
            <p>æ¨å¥¨:5åˆ†å‰çµ‚äº†</p>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-number" id="todayCount">0</div>
                <div class="stat-label">ä»Šæ—¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="monthlyCount">0</div>
                <div class="stat-label">ä»Šæœˆã®ä½¿ç”¨å›æ•°</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="remainingCount">50</div>
                <div class="stat-label">æ®‹ã‚Šä½¿ç”¨å¯èƒ½å›æ•°</div>
            </div>
        </div>

        <div class="current-session" id="currentSession">
            <p>é–‹å§‹: <span id="startTime"></span></p>
            <p>çµŒé: <span id="elapsedTime" class="time-display">00:00:00</span></p>
            <p>æ¨å¥¨çµ‚äº†: <span id="recommendedEnd" class="recommended"></span></p>
            <p>çµ‚äº†: <span id="sessionEnd" class="warning"></span></p>
            
            <div class="remaining-time" id="remainingTime"></div>
            
            <div id="warningMessage" style="display: none; margin-top: 5px;" class="warning">
                âš ï¸ çµ‚äº†æ¨å¥¨æ™‚åˆ»ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™ï¼
            </div>
        </div>

        <div class="time-input-container">
            <h4>æ‰‹å‹•è¨­å®š:</h4>
            <input type="time" id="manualStartTime" class="time-input">
            <button onclick="startSessionWithTime()">æŒ‡å®šæ™‚åˆ»ã§é–‹å§‹</button>
        </div>
        
        <div>
            <button id="startBtn" onclick="startSession()">é–‹å§‹</button>
            <button id="stopBtn" onclick="stopSession()" disabled>çµ‚äº†</button>
            <input type="time" id="manualEndTime" class="time-input" style="display: none;">
            <button id="stopWithTimeBtn" onclick="stopSessionWithTime()" style="display: none;">æŒ‡å®šæ™‚åˆ»ã§çµ‚äº†</button>
            <button onclick="toggleDebugPanel()" style="background: #f39c12; font-size: 9px;">Debug</button>
        </div>

        <div class="time-input-container">
            <h4>æ®µéšã‚¢ãƒ©ãƒ¼ãƒ :</h4>
            <button onclick="setMultipleAlarms()">19:25ã€œ21:00è¨­å®š</button>
            <button onclick="cancelAllAlarms()" style="background: #f44336;">å…¨ã¦åœæ­¢</button>
        </div>

        <div class="history">
            <h3>ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´</h3>
            <button onclick="exportToCSV()" style="background: #2196F3;">CSVå‡ºåŠ›</button>
            <button onclick="importData()" style="background: #4CAF50;">ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ</button>
            <div id="historyList"></div>
        </div>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
    <div class="debug-panel" id="debugPanel" style="display: none;">
        <div class="debug-controls">
            <button onclick="showLocalStorageData()" style="background: #3498db;">LocalStorageè¡¨ç¤º</button>
            <button onclick="checkDataMigration()" style="background: #e74c3c;">ç§»è¡Œãƒ‡ãƒ¼ã‚¿ç¢ºèª</button>
            <button onclick="clearDebugLog()" style="background: #95a5a6;">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <button onclick="toggleDebugPanel()" style="background: #7f8c8d;">é–‰ã˜ã‚‹</button>
        </div>
        <div class="debug-log" id="debugLog">ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–‹å§‹...</div>
    </div>

    <script>
        let currentSession = null;
        let intervalId = null;
        let alarmTimeouts = [];

        // ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½
        function debugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debugLog');
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }

        function toggleDebugPanel() {
            const panel = document.getElementById('debugPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                debugLog('ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã‚’é–‹ãã¾ã—ãŸ');
            } else {
                panel.style.display = 'none';
            }
        }

        function showLocalStorageData() {
            debugLog('=== LocalStorage ãƒ‡ãƒ¼ã‚¿ç¢ºèª ===');
            const sessions = localStorage.getItem('claudeSessions');
            const currentSession = localStorage.getItem('claudeCurrentSession');
            
            debugLog(`claudeSessions: ${sessions ? JSON.stringify(JSON.parse(sessions), null, 2) : 'null'}`);
            debugLog(`claudeCurrentSession: ${currentSession ? JSON.stringify(JSON.parse(currentSession), null, 2) : 'null'}`);
            debugLog('=== ç¢ºèªå®Œäº† ===');
        }

        function checkDataMigration() {
            debugLog('=== ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒçŠ¶æ³ç¢ºèª ===');
            const sessions = loadSessions();
            debugLog(`ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: ${sessions.length}`);
            
            if (sessions.length > 0) {
                const latest = sessions[sessions.length - 1];
                debugLog(`æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${new Date(latest.startTime).toLocaleString()}`);
            }
            
            if (currentSession) {
                debugLog(`ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³: é–‹å§‹æ™‚åˆ» ${new Date(currentSession.startTime).toLocaleString()}`);
            } else {
                debugLog('ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³: ãªã—');
            }
            debugLog('=== ç¢ºèªå®Œäº† ===');
        }

        function clearDebugLog() {
            document.getElementById('debugLog').textContent = 'ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...\n';
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        function loadSessions() {
            const sessions = localStorage.getItem('claudeSessions');
            return sessions ? JSON.parse(sessions) : [];
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
        function saveSessions(sessions) {
            localStorage.setItem('claudeSessions', JSON.stringify(sessions));
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ¡ãƒ¢ã‚’è¿½åŠ 
        function addSessionMemo(session) {
            if (!session.memo) {
                session.memo = '';
            }
            return session;
        }

        // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
        function saveCurrentSession() {
            if (currentSession) {
                localStorage.setItem('claudeCurrentSession', JSON.stringify(currentSession));
            } else {
                localStorage.removeItem('claudeCurrentSession');
            }
        }

        // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã‚€
        function loadCurrentSession() {
            const saved = localStorage.getItem('claudeCurrentSession');
            return saved ? JSON.parse(saved) : null;
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
        function startSession() {
            const now = new Date();
            currentSession = {
                startTime: now.toISOString(),
                endTime: null,
                duration: null,
                memo: ''
            };

            // UIæ›´æ–°
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('currentSession').style.display = 'block';
            document.getElementById('manualEndTime').style.display = 'inline';
            document.getElementById('stopWithTimeBtn').style.display = 'inline';
            document.getElementById('verticalProgressContainer').style.display = 'flex';
            
            // æ™‚åˆ»è¡¨ç¤º
            document.getElementById('startTime').textContent = formatTime(now);
            
            // çµ‚äº†æ¨å¥¨æ™‚åˆ»ï¼ˆ4æ™‚é–“55åˆ†å¾Œï¼‰
            const recommendedEnd = new Date(now.getTime() + (4 * 60 + 55) * 60 * 1000);
            document.getElementById('recommendedEnd').textContent = formatTime(recommendedEnd);
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚åˆ»ï¼ˆ5æ™‚é–“å¾Œï¼‰
            const sessionEnd = new Date(now.getTime() + 5 * 60 * 60 * 1000);
            document.getElementById('sessionEnd').textContent = formatTime(sessionEnd);

            // çµŒéæ™‚é–“ã®æ›´æ–°ã‚’é–‹å§‹
            updateElapsedTime();
            intervalId = setInterval(updateElapsedTime, 1000);
            
            // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
            saveCurrentSession();
            
            // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
            updateStats();
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
        function stopSession() {
            if (!currentSession) return;

            const endTime = new Date();
            currentSession.endTime = endTime.toISOString();
            currentSession.duration = endTime - new Date(currentSession.startTime);

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
            const sessions = loadSessions();
            sessions.push(currentSession);
            saveSessions(sessions);

            // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }

            // UIæ›´æ–°
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('currentSession').style.display = 'none';
            document.getElementById('warningMessage').style.display = 'none';
            document.getElementById('manualEndTime').style.display = 'none';
            document.getElementById('stopWithTimeBtn').style.display = 'none';
            document.getElementById('verticalProgressContainer').style.display = 'none';

            currentSession = null;
            saveCurrentSession(); // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
            updateHistory();
            updateStats();
        }

        // æŒ‡å®šæ™‚åˆ»ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
        function startSessionWithTime() {
            const timeInput = document.getElementById('manualStartTime').value;
            if (!timeInput) {
                alert('é–‹å§‹æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const now = new Date();
            const [hours, minutes] = timeInput.split(':').map(Number);
            const startTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);
            
            // æœªæ¥ã®æ™‚åˆ»ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã¯è­¦å‘Š
            if (startTime > now) {
                alert('æœªæ¥ã®æ™‚åˆ»ã¯æŒ‡å®šã§ãã¾ã›ã‚“');
                return;
            }

            currentSession = {
                startTime: startTime.toISOString(),
                endTime: null,
                duration: null,
                memo: ''
            };

            // UIæ›´æ–°
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('currentSession').style.display = 'block';
            document.getElementById('manualEndTime').style.display = 'inline';
            document.getElementById('stopWithTimeBtn').style.display = 'inline';
            document.getElementById('verticalProgressContainer').style.display = 'flex';
            
            // æ™‚åˆ»è¡¨ç¤º
            document.getElementById('startTime').textContent = formatTime(startTime);
            
            // çµ‚äº†æ¨å¥¨æ™‚åˆ»ï¼ˆ4æ™‚é–“55åˆ†å¾Œï¼‰
            const recommendedEnd = new Date(startTime.getTime() + (4 * 60 + 55) * 60 * 1000);
            document.getElementById('recommendedEnd').textContent = formatTime(recommendedEnd);
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚åˆ»ï¼ˆ5æ™‚é–“å¾Œï¼‰
            const sessionEnd = new Date(startTime.getTime() + 5 * 60 * 60 * 1000);
            document.getElementById('sessionEnd').textContent = formatTime(sessionEnd);

            // çµŒéæ™‚é–“ã®æ›´æ–°ã‚’é–‹å§‹
            updateElapsedTime();
            intervalId = setInterval(updateElapsedTime, 1000);
            
            // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
            saveCurrentSession();
            
            // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
            updateStats();
        }

        // çµŒéæ™‚é–“ã‚’æ›´æ–°
        function updateElapsedTime() {
            if (!currentSession) return;

            const now = new Date();
            const start = new Date(currentSession.startTime);
            const elapsed = now - start;

            // çµŒéæ™‚é–“è¡¨ç¤º
            const hours = Math.floor(elapsed / (1000 * 60 * 60));
            const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);
            
            document.getElementById('elapsedTime').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            // æ¨å¥¨çµ‚äº†æ™‚åˆ»ã‚’å‹•çš„ã«æ›´æ–°
            updateRecommendedEndTime(elapsed);

            // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°ï¼ˆç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚‚å«ã‚€ï¼‰
            updateStats();

            // æ®‹ã‚Šæ™‚é–“ã®è¨ˆç®—ï¼ˆ5æ™‚é–“ã¾ã§ï¼‰
            const totalSessionTime = 5 * 60 * 60 * 1000; // 5æ™‚é–“
            const remaining = totalSessionTime - elapsed;
            
            if (remaining > 0) {
                const remainHours = Math.floor(remaining / (1000 * 60 * 60));
                const remainMinutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const remainSeconds = Math.floor((remaining % (1000 * 60)) / 1000);
                
                const remainingTimeEl = document.getElementById('remainingTime');
                remainingTimeEl.textContent = `æ®‹ã‚Š: ${String(remainHours).padStart(2, '0')}:${String(remainMinutes).padStart(2, '0')}:${String(remainSeconds).padStart(2, '0')}`;
                
                // æ®‹ã‚Šæ™‚é–“ã«å¿œã˜ã¦è‰²ã‚’å¤‰æ›´
                if (remaining > 30 * 60 * 1000) { // 30åˆ†ä»¥ä¸Š
                    remainingTimeEl.className = 'remaining-time time-good';
                } else if (remaining > 10 * 60 * 1000) { // 10-30åˆ†
                    remainingTimeEl.className = 'remaining-time time-warning';
                } else { // 10åˆ†ä»¥ä¸‹
                    remainingTimeEl.className = 'remaining-time time-danger';
                }
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°ï¼ˆ3æœ¬ã‚²ãƒ¼ã‚¸ï¼‰
                updateProgressBars(elapsed);
            } else {
                // 1ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†å¾Œã®è¡¨ç¤º
                const sessionTime = 5 * 60 * 60 * 1000; // 5æ™‚é–“
                
                if (elapsed < 2 * sessionTime) {
                    // 1ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†ã€2ã‚»ãƒƒã‚·ãƒ§ãƒ³ç›®é€²è¡Œä¸­
                    document.getElementById('remainingTime').textContent = 'âœ… 1ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†';
                    document.getElementById('remainingTime').className = 'remaining-time time-warning';
                } else {
                    // 2ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†ä»¥é™ã¯è¶…éæ™‚é–“ã‚’è¡¨ç¤º
                    const overTime = elapsed - totalSessionTime;
                    const overHours = Math.floor(overTime / (1000 * 60 * 60));
                    const overMinutes = Math.floor((overTime % (1000 * 60 * 60)) / (1000 * 60));
                    const overSeconds = Math.floor((overTime % (1000 * 60)) / 1000);
                    
                    document.getElementById('remainingTime').textContent = 
                        `â° è¶…é: ${String(overHours).padStart(2, '0')}:${String(overMinutes).padStart(2, '0')}:${String(overSeconds).padStart(2, '0')}`;
                    document.getElementById('remainingTime').className = 'remaining-time time-danger';
                }
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°ï¼ˆ3æœ¬ã‚²ãƒ¼ã‚¸ï¼‰
                updateProgressBars(elapsed);
            }

            // è­¦å‘Šè¡¨ç¤ºï¼ˆ4æ™‚é–“50åˆ†ä»¥é™ï¼‰
            if (elapsed >= (4 * 60 + 50) * 60 * 1000) {
                document.getElementById('warningMessage').style.display = 'block';
            }
        }

        // å±¥æ­´ã‚’æ›´æ–°
        function updateHistory() {
            const sessions = loadSessions();
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            // æ—¥ã”ã¨ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const sessionsByDay = {};
            sessions.forEach((session, index) => {
                const date = new Date(session.startTime).toLocaleDateString('ja-JP');
                if (!sessionsByDay[date]) {
                    sessionsByDay[date] = [];
                }
                sessionsByDay[date].push({ session, index });
            });

            // æœ€æ–°ã®æ—¥ä»˜ã‹ã‚‰è¡¨ç¤ºï¼ˆæœ€å¤§10æ—¥åˆ†ï¼‰
            const sortedDays = Object.keys(sessionsByDay).sort().reverse().slice(0, 10);

            sortedDays.forEach(date => {
                const daySessions = sessionsByDay[date];
                const sessionCount = daySessions.length;

                // æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼ã¨è©•ä¾¡ã‚’è¿½åŠ 
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                
                let statusText = '';
                let statusClass = '';
                if (sessionCount <= 2) {
                    statusText = 'âœ… Good';
                    statusClass = 'day-status-good';
                } else if (sessionCount === 3) {
                    statusText = 'âš ï¸ æ³¨æ„';
                    statusClass = 'day-status-warning';
                } else {
                    statusText = 'ğŸš¨ Danger';
                    statusClass = 'day-status-danger';
                }

                dayHeader.innerHTML = `
                    <span>${date} (${sessionCount}ã‚»ãƒƒã‚·ãƒ§ãƒ³)</span>
                    <span class="${statusClass}">${statusText}</span>
                `;
                historyList.appendChild(dayHeader);

                // ãã®æ—¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                daySessions.reverse().forEach(({ session, index }) => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    const duration = session.duration / 1000 / 60; // åˆ†å˜ä½
                    const memoDisplay = session.memo ? ` ${session.memo}` : '';
                    item.innerHTML = `
                        ${formatTime(new Date(session.startTime))} ï½ ${formatTime(new Date(session.endTime))}
                        (${Math.floor(duration)}åˆ†)${memoDisplay}
                        <button onclick="editSessionTime(${index})" style="font-size: 9px; padding: 2px 5px;">æ™‚åˆ»</button>
                        <button onclick="editSessionMemo(${index})" style="font-size: 9px; padding: 2px 5px;">ãƒ¡ãƒ¢</button>
                    `;
                    historyList.appendChild(item);
                });
            });
        }

        // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
        function updateStats() {
            const sessions = loadSessions();
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const todayStr = now.toLocaleDateString('ja-JP');

            // ä»Šæ—¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’è¨ˆç®—ï¼ˆç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚‚å«ã‚€ï¼‰
            let todaySessions = sessions.filter(session => {
                const sessionDate = new Date(session.startTime);
                return sessionDate.toLocaleDateString('ja-JP') === todayStr;
            });
            
            let todayCount = todaySessions.length;
            
            // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã¯çµŒéæ™‚é–“ã«åŸºã¥ã„ã¦ã‚«ã‚¦ãƒ³ãƒˆ
            if (currentSession) {
                const currentSessionDate = new Date(currentSession.startTime);
                if (currentSessionDate.toLocaleDateString('ja-JP') === todayStr) {
                    const now = new Date();
                    const elapsed = now - currentSessionDate;
                    const sessionTime = 5 * 60 * 60 * 1000; // 5æ™‚é–“
                    const currentSessionCount = Math.floor(elapsed / sessionTime) + 1;
                    todayCount += currentSessionCount;
                }
            }

            // ä»Šæœˆã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’è¨ˆç®—ï¼ˆç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚‚å«ã‚€ï¼‰
            const monthSessions = sessions.filter(session => {
                const sessionDate = new Date(session.startTime);
                return sessionDate.getMonth() === currentMonth && 
                       sessionDate.getFullYear() === currentYear;
            });
            
            let monthCount = monthSessions.length;
            if (currentSession) {
                const currentSessionDate = new Date(currentSession.startTime);
                if (currentSessionDate.getMonth() === currentMonth && 
                    currentSessionDate.getFullYear() === currentYear) {
                    const now = new Date();
                    const elapsed = now - currentSessionDate;
                    const sessionTime = 5 * 60 * 60 * 1000; // 5æ™‚é–“
                    const currentSessionCount = Math.floor(elapsed / sessionTime) + 1;
                    monthCount += currentSessionCount;
                }
            }

            // è¡¨ç¤ºã‚’æ›´æ–°
            const todayElement = document.getElementById('todayCount');
            todayElement.textContent = todayCount;
            
            // ä»Šæ—¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã«å¿œã˜ã¦è‰²ã‚’å¤‰æ›´
            if (todayCount <= 2) {
                todayElement.className = 'stat-number day-status-good';
            } else if (todayCount === 3) {
                todayElement.className = 'stat-number day-status-warning';
            } else {
                todayElement.className = 'stat-number day-status-danger';
            }

            document.getElementById('monthlyCount').textContent = monthCount;
            document.getElementById('remainingCount').textContent = 50 - monthCount;
        }

        // æ™‚åˆ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatTime(date) {
            return date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        }

        // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatDate(date) {
            return date.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
        }

        // CSVå‡ºåŠ›æ©Ÿèƒ½
        function exportToCSV() {
            const sessions = loadSessions();
            
            // CSVãƒ˜ãƒƒãƒ€ãƒ¼
            let csv = 'é–‹å§‹æ—¥,é–‹å§‹æ™‚åˆ»,çµ‚äº†æ™‚åˆ»,çµŒéæ™‚é–“ï¼ˆåˆ†ï¼‰\n';
            
            sessions.forEach(session => {
                const start = new Date(session.startTime);
                const end = new Date(session.endTime);
                const duration = Math.floor(session.duration / 1000 / 60);
                
                csv += `${formatFullDate(start)},${formatTime(start)},${formatTime(end)},${duration}\n`;
            });
            
            // BOMã‚’è¿½åŠ ï¼ˆExcelå¯¾å¿œï¼‰
            const bom = '\uFEFF';
            const blob = new Blob([bom + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, 'claude_sessions.csv');
            } else {
                link.href = URL.createObjectURL(blob);
                link.download = `claude_sessions_${formatFullDate(new Date())}.csv`;
                link.click();
            }
        }
        
        // å®Œå…¨ãªæ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatFullDate(date) {
            return date.toLocaleDateString('ja-JP', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit' 
            }).replace(/\//g, '-');
        }

        // æ¨å¥¨çµ‚äº†æ™‚åˆ»ã‚’å‹•çš„ã«æ›´æ–°
        function updateRecommendedEndTime(elapsed) {
            const start = new Date(currentSession.startTime);
            const sessionTime = 5 * 60 * 60 * 1000; // 5æ™‚é–“
            
            // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’è¨ˆç®—
            const currentSessionNumber = Math.floor(elapsed / sessionTime) + 1;
            
            // ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹æ™‚åˆ»ã‚’è¨ˆç®—
            const currentSessionStart = new Date(start.getTime() + (currentSessionNumber - 1) * sessionTime);
            
            // æ¨å¥¨çµ‚äº†æ™‚åˆ»ï¼ˆç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®4æ™‚é–“55åˆ†å¾Œï¼‰
            const recommendedEnd = new Date(currentSessionStart.getTime() + (4 * 60 + 55) * 60 * 1000);
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚åˆ»ï¼ˆç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®5æ™‚é–“å¾Œï¼‰
            const sessionEnd = new Date(currentSessionStart.getTime() + sessionTime);
            
            document.getElementById('recommendedEnd').textContent = formatTime(recommendedEnd);
            document.getElementById('sessionEnd').textContent = formatTime(sessionEnd);
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’æ›´æ–°ï¼ˆç¸¦ã‚²ãƒ¼ã‚¸ã®ã¿ï¼‰
        function updateProgressBars(elapsed) {
            const sessionTime = 5 * 60 * 60 * 1000; // 5æ™‚é–“
            
            // å„ã‚²ãƒ¼ã‚¸ã®é€²æ—ã‚’è¨ˆç®—
            const progress1 = Math.min((elapsed / sessionTime) * 100, 100);
            const progress2 = Math.max(0, Math.min(((elapsed - sessionTime) / sessionTime) * 100, 100));
            const progress3 = Math.max(0, Math.min(((elapsed - 2 * sessionTime) / sessionTime) * 100, 100));
            
            // ç¸¦ã‚²ãƒ¼ã‚¸ã‚’æ›´æ–°ï¼ˆå„5æ™‚é–“ï¼‰
            document.getElementById('verticalProgressFill1').style.height = `${progress1}%`;
            document.getElementById('verticalProgressFill2').style.height = `${progress2}%`;
            document.getElementById('verticalProgressFill3').style.height = `${progress3}%`;
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ™‚åˆ»ã‚’ç·¨é›†
        function editSessionTime(index) {
            const sessions = loadSessions();
            const session = sessions[index];
            
            const newEndTime = prompt('æ–°ã—ã„çµ‚äº†æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (HH:MM)', 
                formatTime(new Date(session.endTime)));
            
            if (!newEndTime) return;
            
            const [hours, minutes] = newEndTime.split(':').map(Number);
            const startDate = new Date(session.startTime);
            const endDate = new Date(
                startDate.getFullYear(), 
                startDate.getMonth(), 
                startDate.getDate(), 
                hours, 
                minutes, 
                0
            );
            
            // æ—¥ä»˜ã‚’è·¨ã„ã å ´åˆã®å‡¦ç†
            if (endDate <= startDate) {
                endDate.setDate(endDate.getDate() + 1);
            }
            
            session.endTime = endDate.toISOString();
            session.duration = endDate - startDate;
            
            sessions[index] = session;
            saveSessions(sessions);
            
            updateHistory();
            updateStats();
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒ¢ã‚’ç·¨é›†
        function editSessionMemo(index) {
            const sessions = loadSessions();
            const session = sessions[index];
            
            const newMemo = prompt('ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', session.memo || '');
            
            if (newMemo === null) return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            
            session.memo = newMemo;
            sessions[index] = session;
            saveSessions(sessions);
            
            updateHistory();
        }

        // æŒ‡å®šæ™‚åˆ»ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
        function stopSessionWithTime() {
            if (!currentSession) return;
            
            const timeInput = document.getElementById('manualEndTime').value;
            if (!timeInput) {
                alert('çµ‚äº†æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const now = new Date();
            const [hours, minutes] = timeInput.split(':').map(Number);
            const endTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);
            
            // é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå‰ã®æ™‚åˆ»ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã¯è­¦å‘Š
            const startTime = new Date(currentSession.startTime);
            if (endTime <= startTime) {
                alert('çµ‚äº†æ™‚åˆ»ã¯é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šå¾Œã«ã—ã¦ãã ã•ã„');
                return;
            }
            
            // æœªæ¥ã®æ™‚åˆ»ãŒå…¥åŠ›ã•ã‚ŒãŸå ´åˆã¯è­¦å‘Š
            if (endTime > now) {
                alert('æœªæ¥ã®æ™‚åˆ»ã¯æŒ‡å®šã§ãã¾ã›ã‚“');
                return;
            }

            currentSession.endTime = endTime.toISOString();
            currentSession.duration = endTime - startTime;

            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
            const sessions = loadSessions();
            sessions.push(currentSession);
            saveSessions(sessions);

            // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }

            // UIæ›´æ–°
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('currentSession').style.display = 'none';
            document.getElementById('warningMessage').style.display = 'none';
            document.getElementById('manualEndTime').style.display = 'none';
            document.getElementById('stopWithTimeBtn').style.display = 'none';
            document.getElementById('verticalProgressContainer').style.display = 'none';
            document.getElementById('manualEndTime').value = '';

            currentSession = null;
            saveCurrentSession();
            updateHistory();
            updateStats();
        }

        // è¤‡æ•°ã‚¢ãƒ©ãƒ¼ãƒ ã‚’è¨­å®š
        function setMultipleAlarms() {
            // æ—¢å­˜ã®ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            cancelAllAlarms();
            
            const now = new Date();
            const alarmTimes = [
                { time: '19:25', beeps: 1 },
                { time: '19:30', beeps: 2 },
                { time: '19:35', beeps: 3 },
                { time: '19:40', beeps: 4 },
                { time: '19:45', beeps: 5 },
                { time: '19:50', beeps: 6 },
                { time: '19:55', beeps: 7 },
                { time: '20:00', beeps: 8 },
                { time: '20:05', beeps: 9 },
                { time: '20:10', beeps: 10 },
                { time: '20:15', beeps: 11 },
                { time: '20:20', beeps: 12 },
                { time: '20:25', beeps: 13 },
                { time: '20:30', beeps: 14 },
                { time: '20:35', beeps: 15 },
                { time: '20:40', beeps: 16 },
                { time: '20:45', beeps: 17 },
                { time: '20:50', beeps: 18 },
                { time: '20:55', beeps: 19 },
                { time: '21:00', beeps: 20 }
            ];
            
            alarmTimes.forEach(({ time, beeps }) => {
                const [hours, minutes] = time.split(':').map(Number);
                const alarmTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);
                
                // éå»ã®æ™‚åˆ»ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                if (alarmTime > now) {
                    const timeToAlarm = alarmTime - now;
                    
                    const timeout = setTimeout(() => {
                        playAlarmWithBeeps(beeps, time);
                    }, timeToAlarm);
                    
                    alarmTimeouts.push(timeout);
                }
            });
            
            alert('æ®µéšã‚¢ãƒ©ãƒ¼ãƒ ã‚’è¨­å®šã—ã¾ã—ãŸï¼š19:25ã€œ21:00ã¾ã§5åˆ†ã”ã¨');
        }
        
        // å…¨ã¦ã®ã‚¢ãƒ©ãƒ¼ãƒ ã‚’åœæ­¢
        function cancelAllAlarms() {
            alarmTimeouts.forEach(timeout => clearTimeout(timeout));
            alarmTimeouts = [];
            alert('å…¨ã¦ã®ã‚¢ãƒ©ãƒ¼ãƒ ã‚’åœæ­¢ã—ã¾ã—ãŸ');
        }
        
        // æŒ‡å®šå›æ•°ã®ãƒ“ãƒ¼ãƒ—éŸ³ã‚’å†ç”Ÿ
        function playAlarmWithBeeps(beepCount, timeStr) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            let beepIndex = 0;
            function playBeep() {
                if (beepIndex >= beepCount) {
                    return;
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800; // 800Hzã®éŸ³
                gainNode.gain.value = 0.3;
                
                oscillator.start();
                
                setTimeout(() => {
                    oscillator.stop();
                    beepIndex++;
                    
                    if (beepIndex < beepCount) {
                        setTimeout(playBeep, 300);
                    }
                }, 200);
            }
            
            playBeep();
            
            // é€šçŸ¥ã‚‚è¡¨ç¤º
            if (Notification.permission === 'granted') {
                new Notification(`ã‚¢ãƒ©ãƒ¼ãƒ  ${timeStr}`, {
                    body: `${beepCount}å›ã®ã‚¢ãƒ©ãƒ¼ãƒ `,
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDNi40NzcgMiAyIDYuNDc3IDIgMTJzNC40NzcgMTAgMTAgMTAgMTAtNC40NzcgMTAtMTBTMTcuNTIzIDIgMTIgMnoiIGZpbGw9IiNmZjY2MDAiLz4KPHBhdGggZD0iTTEyIDZjLTMuMzEzIDAtNiAyLjY4Ny02IDZzMi42ODcgNiA2IDYgNi0yLjY4NyA2LTYtMi42ODctNi02LTZ6IiBmaWxsPSIjZmZmIi8+Cjwvc3ZnPg=='
                });
            }
            
            alert(`â° ${timeStr} - ${beepCount}å›ã®ã‚¢ãƒ©ãƒ¼ãƒ ï¼`);
        }

        // ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ã‚’å†ç”Ÿ
        function playAlarm() {
            // ãƒ“ãƒ¼ãƒ—éŸ³ã‚’ç”Ÿæˆ
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800; // 800Hzã®éŸ³
            gainNode.gain.value = 0.3;
            
            oscillator.start();
            
            // 3å›ãƒ“ãƒ¼ãƒ—éŸ³ã‚’é³´ã‚‰ã™
            setTimeout(() => {
                oscillator.stop();
                
                // 2å›ç›®
                setTimeout(() => {
                    const osc2 = audioContext.createOscillator();
                    const gain2 = audioContext.createGain();
                    osc2.connect(gain2);
                    gain2.connect(audioContext.destination);
                    osc2.frequency.value = 800;
                    gain2.gain.value = 0.3;
                    osc2.start();
                    setTimeout(() => {
                        osc2.stop();
                        
                        // 3å›ç›®
                        setTimeout(() => {
                            const osc3 = audioContext.createOscillator();
                            const gain3 = audioContext.createGain();
                            osc3.connect(gain3);
                            gain3.connect(audioContext.destination);
                            osc3.frequency.value = 800;
                            gain3.gain.value = 0.3;
                            osc3.start();
                            setTimeout(() => osc3.stop(), 200);
                        }, 300);
                    }, 200);
                }, 300);
            }, 200);
            
            // é€šçŸ¥ã‚‚è¡¨ç¤º
            if (Notification.permission === 'granted') {
                new Notification('ã‚¢ãƒ©ãƒ¼ãƒ ', {
                    body: 'ã‚¢ãƒ©ãƒ¼ãƒ æ™‚åˆ»ã«ãªã‚Šã¾ã—ãŸï¼',
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDNi40NzcgMiAyIDYuNDc3IDIgMTJzNC40NzcgMTAgMTAgMTAgMTAtNC40NzcgMTAtMTBTMTcuNTIzIDIgMTIgMnoiIGZpbGw9IiNmZjY2MDAiLz4KPHBhdGggZD0iTTEyIDZjLTMuMzEzIDAtNiAyLjY4Ny02IDZzMi42ODcgNiA2IDYgNi0yLjY4NyA2LTYtMi42ODctNi02LTZ6IiBmaWxsPSIjZmZmIi8+Cjwvc3ZnPg=='
                });
            }
            
            alert('â° ã‚¢ãƒ©ãƒ¼ãƒ æ™‚åˆ»ã«ãªã‚Šã¾ã—ãŸï¼');
        }

        // åˆæœŸåŒ–
        function init() {
            // ä¿å­˜ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¾©å…ƒ
            const savedSession = loadCurrentSession();
            if (savedSession) {
                currentSession = savedSession;
                
                // UIæ›´æ–°
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('currentSession').style.display = 'block';
                document.getElementById('manualEndTime').style.display = 'inline';
                document.getElementById('stopWithTimeBtn').style.display = 'inline';
                document.getElementById('verticalProgressContainer').style.display = 'flex';
                
                const start = new Date(currentSession.startTime);
                document.getElementById('startTime').textContent = formatTime(start);
                
                // çµ‚äº†æ¨å¥¨æ™‚åˆ»
                const recommendedEnd = new Date(start.getTime() + (4 * 60 + 55) * 60 * 1000);
                document.getElementById('recommendedEnd').textContent = formatTime(recommendedEnd);
                
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚åˆ»
                const sessionEnd = new Date(start.getTime() + 5 * 60 * 60 * 1000);
                document.getElementById('sessionEnd').textContent = formatTime(sessionEnd);
                
                // çµŒéæ™‚é–“ã®æ›´æ–°ã‚’é–‹å§‹
                updateElapsedTime();
                intervalId = setInterval(updateElapsedTime, 1000);
            }
            
            updateHistory();
            updateStats();
            
            // é€šçŸ¥ã®è¨±å¯ã‚’è¦æ±‚
            if (Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæ©Ÿèƒ½
        function importData() {
            debugLog('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæ©Ÿèƒ½ã‚’é–‹å§‹');
            
            const instructions = `
ãƒ‡ãƒ¼ã‚¿ç§»è¡Œæ‰‹é †ï¼š

1. ãƒ­ãƒ¼ã‚«ãƒ«ç‰ˆ claude-session-manager.html ã‚’é–‹ã
2. F12ã‚­ãƒ¼ã§é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã
3. Consoleã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œï¼š

localStorage.getItem('claudeSessions')

5. å‡ºåŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆnullä»¥å¤–ï¼‰
6. ã“ã®ãƒœã‚¿ãƒ³ã‚’ã‚‚ã†ä¸€åº¦æŠ¼ã—ã¦è²¼ã‚Šä»˜ã‘

ç¶šã‘ã¾ã™ã‹ï¼Ÿ`;
            
            if (!confirm(instructions)) {
                debugLog('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
                return;
            }
            
            const sessionsData = prompt('ãƒ­ãƒ¼ã‚«ãƒ«ç‰ˆã§å–å¾—ã—ãŸsessionsãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„:');
            debugLog(`å…¥åŠ›ã•ã‚ŒãŸsessionsData: ${sessionsData ? sessionsData.substring(0, 100) + '...' : 'null'}`);
            
            const currentSessionData = prompt('ãƒ­ãƒ¼ã‚«ãƒ«ç‰ˆã§å–å¾—ã—ãŸcurrentSessionãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼ˆãªã‘ã‚Œã°ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰:');
            debugLog(`å…¥åŠ›ã•ã‚ŒãŸcurrentSessionData: ${currentSessionData ? currentSessionData.substring(0, 100) + '...' : 'null'}`);
            
            if (sessionsData && sessionsData !== 'null') {
                try {
                    // ãƒ‡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
                    const parsedSessions = JSON.parse(sessionsData);
                    debugLog(`ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°: ${parsedSessions.length}`);
                    
                    localStorage.setItem('claudeSessions', sessionsData);
                    debugLog('sessionsãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    
                    if (currentSessionData && currentSessionData !== 'null') {
                        const parsedCurrentSession = JSON.parse(currentSessionData);
                        localStorage.setItem('claudeCurrentSession', currentSessionData);
                        debugLog('currentSessionãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    }
                    
                    debugLog('ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚');
                    alert('ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå®Œäº†ã—ã¾ã—ãŸï¼ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚');
                    location.reload();
                } catch (e) {
                    debugLog(`ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚¨ãƒ©ãƒ¼: ${e.message}`);
                    alert('ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                }
            } else {
                debugLog('æœ‰åŠ¹ãªsessionsãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
            }
        }

        init();
    </script>
</body>
</html>